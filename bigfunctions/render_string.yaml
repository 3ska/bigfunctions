type: function_js
samples:
  - "render_string(template, context)"
description: |-
  Replaces the variables surrounded by brackets such as `{{variable_name}}` in `template` by their values defined in `context`.
  Beware that `context` keys and string values must be surrounded by double-quotes `"` and not single-quotes `'`.
arguments:
  - name: template
    type: STRING
    test_value: Hello {{username}}
  - name: context
    type: STRING
    test_value: '{"username": "James"}'
output:
  name: rendered_content
  type: STRING
  expected_value: Hello James
example: |-
  ``` sql
  SELECT {BIGFUNCTIONS_DATASET}.render_string('Hello {{username}}', '{"username": "James"}') as rendered_content;

  +-------------+
  | rendered_content     |
  +-------------+
  | Hello World |
  +-------------+
  ```
code: |
  context = JSON.parse(context);
  var env = nunjucks.configure();

  env.addFilter('add_thousands_separators_to_integers', function(x) {
      if (Number.isInteger(x)) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
      return x;
  });

  env.addFilter('as_percentage', function(x) {
      if (x > 0.01) {
        return Math.round(x * 100).toString() + ' %';
      }
      if (x < 0.001) {
        return '< 0.1 %';
      }
      return (0.1 * Math.round(x * 1000)).toString() + ' %';
  });

  env.addFilter('size_bytes_pretty', function(x) {
      if (x > 1e12) {
        return Math.round(x / (1024*1024*1024*1024)).toString() + ' TB';
      }
      if (x > 1e9) {
        return Math.round(x / (1024*1024*1024)).toString() + ' GB';
      }
      if (x > 1e6) {
        return Math.round(x / (1024*1024)).toString() + ' MB';
      }
      return Math.round(x / (1024)).toString() + ' KB';
  });

  return env.renderString(template, context);
libraries:
  - nunjucks.min.js