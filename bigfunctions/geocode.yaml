type: function_py
category: geographic
author:
  name: Paul Marcombes
  url: https://www.linkedin.com/in/paul-marcombes
  avatar_url: "https://lh3.googleusercontent.com/a-/ACB-R5RDf2yxcw1p_IYLCKmiUIScreatDdhG8B83om6Ohw=s260"
description: Transform Address to Coordinates
arguments:
  - name: address
    type: string
output:
  name: coordinates
  type: string
examples:
  - description: ""
    arguments:
      - "'1 rue des champs elysees, Paris'"
    output: "true"
    region: ALL
code: |
  import json
  import googlemaps
  import google.cloud.secretmanager
  secret_manager = google.cloud.secretmanager.SecretManagerServiceClient()
  gmaps_api_key = secret_manager.access_secret_version(
      name='projects/bigfunctions/secrets/gmaps_api_key/versions/latest'
  ).payload.data.decode('UTF-8')
  gmaps = googlemaps.Client(key=gmaps_api_key)
  geocode = gmaps.geocode(address)
  if not geocode:
    return None
  return json.dumps(geocode[0], ensure_ascii=False)
requirements: |
  google-cloud-secret-manager
  googlemaps
